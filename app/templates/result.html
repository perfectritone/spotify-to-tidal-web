{% extends "base.html" %}

{% block content %}
<div class="card">
    <h3>Sync Complete</h3>
    <div class="stats-grid">
        {% if result.playlists %}
        <div class="stat-item">
            <span class="stat-number">{{ result.playlists.synced }}</span>
            <span class="stat-label">Playlists</span>
        </div>
        {% endif %}
        {% if result.favorites %}
        <div class="stat-item">
            <span class="stat-number">{{ result.favorites.added }}</span>
            <span class="stat-label">Favorites</span>
        </div>
        {% endif %}
        {% if result.albums %}
        <div class="stat-item">
            <span class="stat-number">{{ result.albums.added }}</span>
            <span class="stat-label">Albums</span>
        </div>
        {% endif %}
        {% if result.artists %}
        <div class="stat-item">
            <span class="stat-number">{{ result.artists.added }}</span>
            <span class="stat-label">Artists</span>
        </div>
        {% endif %}
    </div>
</div>

{% set has_not_found = (result.playlists and result.playlists.not_found) or
                       (result.favorites and result.favorites.not_found) or
                       (result.albums and result.albums.not_found) or
                       (result.artists and result.artists.not_found) %}

{% if has_not_found %}
<div class="card">
    <h3 class="error-title">Not Found on Tidal</h3>
    <p class="error-subtitle">These items may not be available or have different names.</p>

    {% if result.playlists and result.playlists.not_found %}
    <details class="not-found-section">
        <summary>
            <span class="section-icon">üéµ</span>
            <span class="section-title">Playlist Tracks</span>
            <span class="section-count">{{ result.playlists.not_found|length }}</span>
        </summary>
        <ul class="not-found-list">
            {% for track in result.playlists.not_found %}
            <li>{{ track }}</li>
            {% endfor %}
        </ul>
    </details>
    {% endif %}

    {% if result.favorites and result.favorites.not_found %}
    <details class="not-found-section">
        <summary>
            <span class="section-icon">‚ù§Ô∏è</span>
            <span class="section-title">Liked Songs</span>
            <span class="section-count">{{ result.favorites.not_found|length }}</span>
        </summary>
        <ul class="not-found-list">
            {% for track in result.favorites.not_found %}
            <li>{{ track }}</li>
            {% endfor %}
        </ul>
    </details>
    {% endif %}

    {% if result.albums and result.albums.not_found %}
    <details class="not-found-section">
        <summary>
            <span class="section-icon">üíø</span>
            <span class="section-title">Albums</span>
            <span class="section-count">{{ result.albums.not_found|length }}</span>
        </summary>
        <ul class="not-found-list">
            {% for album in result.albums.not_found %}
            <li>{{ album }}</li>
            {% endfor %}
        </ul>
    </details>
    {% endif %}

    {% if result.artists and result.artists.not_found %}
    <details class="not-found-section">
        <summary>
            <span class="section-icon">üé§</span>
            <span class="section-title">Artists</span>
            <span class="section-count">{{ result.artists.not_found|length }}</span>
        </summary>
        <ul class="not-found-list">
            {% for artist in result.artists.not_found %}
            <li>{{ artist }}</li>
            {% endfor %}
        </ul>
    </details>
    {% endif %}
</div>
{% endif %}

{% set has_errors = (result.playlists and result.playlists.error) or
                    (result.favorites and result.favorites.error) or
                    (result.albums and result.albums.error) or
                    (result.artists and result.artists.error) %}

{% if has_errors %}
<div class="card error-card">
    <h3 class="warning-title">Errors</h3>
    {% if result.playlists and result.playlists.error %}
    <p class="error-item"><strong>Playlists:</strong> {{ result.playlists.error }}</p>
    {% endif %}
    {% if result.favorites and result.favorites.error %}
    <p class="error-item"><strong>Favorites:</strong> {{ result.favorites.error }}</p>
    {% endif %}
    {% if result.albums and result.albums.error %}
    <p class="error-item"><strong>Albums:</strong> {{ result.albums.error }}</p>
    {% endif %}
    {% if result.artists and result.artists.error %}
    <p class="error-item"><strong>Artists:</strong> {{ result.artists.error }}</p>
    {% endif %}
</div>
{% endif %}

<a href="/" class="btn btn-primary">
    <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>
    Sync Again
</a>

<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
    }

    .stat-item {
        padding: 1.25rem;
        background: var(--bg-secondary);
        border-radius: 12px;
        text-align: center;
    }

    .stat-number {
        display: block;
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(135deg, var(--spotify) 0%, var(--tidal) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .stat-label {
        display: block;
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-top: 0.25rem;
    }

    .error-title {
        color: var(--error) !important;
    }

    .error-subtitle {
        color: var(--text-muted);
        font-size: 0.85rem;
        margin-bottom: 1rem;
    }

    .warning-title {
        color: #f39c12 !important;
    }

    .error-card {
        border-left: 3px solid #f39c12;
    }

    .error-item {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    .error-item:last-child {
        margin-bottom: 0;
    }

    .not-found-section {
        margin-bottom: 0.5rem;
        border: 1px solid var(--border);
        border-radius: 10px;
        overflow: hidden;
    }

    .not-found-section summary {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        background: var(--bg-secondary);
        cursor: pointer;
        user-select: none;
        font-size: 0.9rem;
        list-style: none;
    }

    .not-found-section summary::-webkit-details-marker {
        display: none;
    }

    .not-found-section summary::before {
        content: "‚Ä∫";
        margin-right: 0.75rem;
        font-size: 1.2rem;
        color: var(--text-muted);
        transition: transform 0.2s;
    }

    .not-found-section[open] summary::before {
        transform: rotate(90deg);
    }

    .not-found-section summary:hover {
        background: rgba(255, 255, 255, 0.04);
    }

    .not-found-section[open] summary {
        border-bottom: 1px solid var(--border);
    }

    .section-icon {
        margin-right: 0.5rem;
    }

    .section-title {
        flex: 1;
        font-weight: 500;
    }

    .section-count {
        background: var(--error);
        color: #fff;
        padding: 0.15rem 0.5rem;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 600;
    }

    .not-found-list {
        list-style: none;
        max-height: 250px;
        overflow-y: auto;
    }

    .not-found-list li {
        padding: 0.5rem 1rem;
        border-bottom: 1px solid var(--border);
        color: var(--text-secondary);
        font-size: 0.85rem;
    }

    .not-found-list li:last-child {
        border-bottom: none;
    }

    .not-found-list li:hover {
        background: rgba(255, 255, 255, 0.02);
    }
</style>
{% endblock %}
